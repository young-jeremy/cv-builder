{% load static %}
{% load crispy_forms_tags %}

{% block title %}Create Your Resume - {{ template.name }} | ResumeMe{% endblock %}

{% block extra_css %}
<style>
    .resume-form-container {
        max-width: 1200px;
        margin: 2rem auto;
        padding: 0 1rem;
    }
    
    .resume-form-header {
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .resume-form-title {
        font-size: 2rem;
        font-weight: 700;
        color: #1e293b;
        margin-bottom: 0.5rem;
    }
    
    .resume-form-subtitle {
        font-size: 1.1rem;
        color: #64748b;
    }
    
    .resume-form-layout {
        display: flex;
        gap: 2rem;
    }
    
    .resume-form-sidebar {
        width: 280px;
        flex-shrink: 0;
    }
    
    .resume-form-content {
        flex: 1;
    }
    
    .form-nav {
        position: sticky;
        top: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }
    
    .form-nav-header {
        padding: 1rem;
        background-color: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-nav-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1e293b;
    }
    
    .form-nav-list {
        list-style: none;
        padding: 0;
        margin: 0;
    }
    
    .form-nav-item {
        border-bottom: 1px solid #e2e8f0;
    }
    
    .form-nav-item:last-child {
        border-bottom: none;
    }
    
    .form-nav-link {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        padding: 1rem;
        color: #64748b;
        text-decoration: none;
        transition: all 0.2s ease;
    }
    
    .form-nav-link:hover {
        background-color: #f8fafc;
        color: #1e293b;
    }
    
    .form-nav-link.active {
        background-color: #f0f7ff;
        color: #0d6efd;
        font-weight: 500;
    }
    
    .form-nav-icon {
        font-size: 1.25rem;
    }
    
    .form-section {
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        padding: 2rem;
        margin-bottom: 2rem;
    }
    
    .form-section-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
    }
    
    .form-section-icon {
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f0f7ff;
        color: #0d6efd;
        border-radius: 8px;
        font-size: 1.25rem;
    }
    
    .form-section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #1e293b;
    }
    
    .form-row {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        font-weight: 500;
        color: #475569;
        margin-bottom: 0.5rem;
    }
    
    .form-control {
        border: 1px solid #cbd5e1;
        border-radius: 6px;
        padding: 0.75rem;
        width: 100%;
        font-size: 1rem;
        transition: all 0.2s ease;
    }
    
    .form-control:focus {
        border-color: #0d6efd;
        box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
        outline: none;
    }
    
    .form-text {
        font-size: 0.875rem;
        color: #64748b;
        margin-top: 0.25rem;
    }
    
    .form-check {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.5rem;
    }
    
    .form-check-input {
        width: 1rem;
        height: 1rem;
    }
    
    .form-check-label {
        font-size: 0.95rem;
        color: #475569;
    }
    
    .dynamic-form-items {
        margin-bottom: 1rem;
    }
    
    .dynamic-form-item {
        background-color: #f8fafc;
        border-radius: 8px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        position: relative;
    }
    
    .dynamic-form-item-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
    }
    
    .dynamic-form-item-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1e293b;
    }
    
    .dynamic-form-item-actions {
        display: flex;
        gap: 0.5rem;
    }
    
    .btn-item-action {
        background: none;
        border: none;
        color: #64748b;
        font-size: 1rem;
        cursor: pointer;
        padding: 0.25rem;
        border-radius: 4px;
        transition: all 0.2s ease;
    }
    
    .btn-item-action:hover {
        color: #0d6efd;
        background-color: #f0f7ff;
    }
    
    .btn-item-action.delete:hover {
        color: #ef4444;
        background-color: #fee2e2;
    }
    
    .btn-add-item {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        background-color: #f8fafc;
        border: 1px dashed #cbd5e1;
        border-radius: 8px;
        padding: 0.75rem 1rem;
        width: 100%;
        font-size: 0.95rem;
        color: #64748b;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-add-item:hover {
        background-color: #f0f7ff;
        border-color: #0d6efd;
        color: #0d6efd;
    }
    
    .form-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
        padding-top: 1.5rem;
        border-top: 1px solid #e2e8f0;
    }
    
    .btn-form-action {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .btn-secondary {
        background-color: #f8fafc;
        color: #64748b;
        border: 1px solid #cbd5e1;
    }
    
    .btn-secondary:hover {
        background-color: #f1f5f9;
        color: #475569;
    }
    
    .btn-primary {
        background-color: #0d6efd;
        color: white;
        border: none;
    }
    
    .btn-primary:hover {
        background-color: #0b5ed7;
    }
    
    .btn-success {
        background-color: #10b981;
        color: white;
        border: none;
    }
    
    .btn-success:hover {
        background-color: #0ea5e9;
    }
    
    .resume-preview-container {
        position: sticky;
        top: 2rem;
        background-color: white;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        margin-top: 2rem;
    }
    
    .resume-preview-header {
        padding: 1rem;
        background-color: #f8fafc;
        border-bottom: 1px solid #e2e8f0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .preview-title {
        font-size: 1rem;
        font-weight: 600;
        color: #1e293b;
    }
    
    .resume-preview-body {
        padding: 1.5rem;
        max-height: 500px;
        overflow-y: auto;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
        .resume-form-layout {
            flex-direction: column;
        }
        
        .resume-form-sidebar {
            width: 100%;
        }
        
        .form-nav {
            position: relative;
            top: 0;
            margin-bottom: 2rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="resume-form-container">
    <div class="resume-form-header">
        <h1 class="resume-form-title">Create Your {{ template.name }} Resume</h1>
        <p class="resume-form-subtitle">Fill in your details to generate a professional resume</p>
    </div>
    
    <div class="resume-form-layout">
        <div class="resume-form-sidebar">
            <nav class="form-nav">
                <div class="form-nav-header">
                    <h2 class="form-nav-title">Resume Sections</h2>
                </div>
                <ul class="form-nav-list">
                    <li class="form-nav-item">
                        <a href="#personal-info" class="form-nav-link active">
                            <i class="bi bi-person form-nav-icon"></i>
                            Personal Information
                        </a>
                    </li>
                    <li class="form-nav-item">
                        <a href="#professional-summary" class="form-nav-link">
                            <i class="bi bi-file-text form-nav-icon"></i>
                            Professional Summary
                        </a>
                    </li>
                    <li class="form-nav-item">
                        <a href="#work-experience" class="form-nav-link">
                            <i class="bi bi-briefcase form-nav-icon"></i>
                            Work Experience
                        </a>
                    </li>
                    <li class="form-nav-item">
                        <a href="#education" class="form-nav-link">
                            <i class="bi bi-mortarboard form-nav-icon"></i>
                            Education
                        </a>
                    </li>
                    <li class="form-nav-item">
                        <a href="#skills" class="form-nav-link">
                            <i class="bi bi-stars form-nav-icon"></i>
                            Skills
                        </a>
                    </li>
                    <li class="form-nav-item">
                        <a href="#additional-sections" class="form-nav-link">
                            <i class="bi bi-plus-circle form-nav-icon"></i>
                            Additional Sections
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="resume-preview-container">
                <div class="resume-preview-header">
                    <div class="preview-title">Live Preview</div>
                </div>
                <div class="resume-preview-body">
                    <div id="resume-preview">
                        <!-- Live preview will be updated via JavaScript -->
                        <p class="text-center text-muted">
                            Fill in your details to see a live preview of your resume.
                        </p>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="resume-form-content">
            <form id="resume-form" method="post" action="{% url 'templates_app:save_resume_details' template_slug=template.slug %}">
                {% csrf_token %}
                
                <!-- Personal Information Section -->
                <div id="personal-info" class="form-section">
                    <div class="form-section-header">
                        <div class="form-section-icon">
                            <i class="bi bi-person"></i>
                        </div>
                        <h2 class="form-section-title">Personal Information</h2>
                    </div>
                    
                    <div class="form-row row">
                        <div class="form-group col-md-6">
                            <label for="first_name">First Name</label>
                            <input type="text" class="form-control" id="first_name" name="first_name" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="last_name">Last Name</label>
                            <input type="text" class="form-control" id="last_name" name="last_name" required>
                        </div>
                    </div>
                    
                    <div class="form-row row">
                        <div class="form-group col-md-6">
                            <label for="email">Email</label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="phone">Phone</label>
                            <input type="tel" class="form-control" id="phone" name="phone" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="address">Address</label>
                            <input type="text" class="form-control" id="address" name="address">
                        </div>
                    </div>
                    
                    <div class="form-row row">
                        <div class="form-group col-md-6">
                            <label for="city">City</label>
                            <input type="text" class="form-control" id="city" name="city">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="state">State</label>
                            <input type="text" class="form-control" id="state" name="state">
                        </div>
                        <div class="form-group col-md-3">
                            <label for="zip_code">Zip Code</label>
                            <input type="text" class="form-control" id="zip_code" name="zip_code">
                        </div>
                    </div>
                    
                    <div class="form-row row">
                        <div class="form-group col-md-6">
                            <label for="linkedin">LinkedIn</label>
                            <input type="text" class="form-control" id="linkedin" name="linkedin">
                            <small class="form-text">e.g., linkedin.com/in/yourname</small>
                        </div>
                        <div class="form-group col-md-6">
                            <label for="website">Website</label>
                            <input type="text" class="form-control" id="website" name="website">
                            <small class="form-text">e.g., yourname.com</small>
                        </div>
                    </div>
                </div>
                
                <!-- Professional Summary Section -->
                <div id="professional-summary" class="form-section">
                    <div class="form-section-header">
                        <div class="form-section-icon">
                            <i class="bi bi-file-text"></i>
                        </div>
                        <h2 class="form-section-title">Professional Summary</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="summary">Summary</label>
                            <textarea class="form-control" id="summary" name="summary" rows="4" placeholder="Write a brief summary of your professional background and key qualifications..."></textarea>
                            <small class="form-text">Keep it concise (3-5 sentences) and highlight your most relevant skills and achievements.</small>
                        </div>
                    </div>
                </div>
                
                <!-- Work Experience Section -->
                <div id="work-experience" class="form-section">
                    <div class="form-section-header">
                        <div class="form-section-icon">
                            <i class="bi bi-briefcase"></i>
                        </div>
                        <h2 class="form-section-title">Work Experience</h2>
                    </div>
                    
                    <div id="experience-items" class="dynamic-form-items">
                        <div class="dynamic-form-item" data-index="0">
                            <div class="dynamic-form-item-header">
                                <h3 class="dynamic-form-item-title">Experience #1</h3>
                                <div class="dynamic-form-item-actions">
                                    <button type="button" class="btn-item-action delete" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-row row">
                                <div class="form-group col-md-6">
                                    <label for="job_title_0">Job Title</label>
                                    <input type="text" class="form-control" id="job_title_0" name="experience[0][job_title]" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="employer_0">Employer</label>
                                    <input type="text" class="form-control" id="employer_0" name="experience[0][employer]" required>
                                </div>
                            </div>
                            
                            <div class="form-row row">
                                <div class="form-group col-md-5">
                                    <label for="start_date_0">Start Date</label>
                                    <input type="text" class="form-control" id="start_date_0" name="experience[0][start_date]" placeholder="e.g., Jan 2020" required>
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="end_date_0">End Date</label>
                                    <input type="text" class="form-control" id="end_date_0" name="experience[0][end_date]" placeholder="e.g., Dec 2022">
                                </div>
                                <div class="form-group col-md-2 d-flex align-items-end">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="current_job_0" name="experience[0][current_job]">
                                        <label class="form-check-label" for="current_job_0">Current Job</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="description_0">Description</label>
                                    <textarea class="form-control" id="description_0" name="experience[0][description]" rows="4" placeholder="Describe your responsibilities and achievements..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="add-experience" class="btn-add-item">
                        <i class="bi bi-plus-circle"></i> Add Another Experience
                    </button>
                </div>
                
                <!-- Education Section -->
                <div id="education" class="form-section">
                    <div class="form-section-header">
                        <div class="form-section-icon">
                            <i class="bi bi-mortarboard"></i>
                        </div>
                        <h2 class="form-section-title">Education</h2>
                    </div>
                    
                    <div id="education-items" class="dynamic-form-items">
                        <div class="dynamic-form-item" data-index="0">
                            <div class="dynamic-form-item-header">
                                <h3 class="dynamic-form-item-title">Education #1</h3>
                                <div class="dynamic-form-item-actions">
                                    <button type="button" class="btn-item-action delete" title="Delete">
                                        <i class="bi bi-trash"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="form-row row">
                                <div class="form-group col-md-6">
                                    <label for="degree_0">Degree</label>
                                    <input type="text" class="form-control" id="degree_0" name="education[0][degree]" required>
                                </div>
                                <div class="form-group col-md-6">
                                    <label for="institution_0">Institution</label>
                                    <input type="text" class="form-control" id="institution_0" name="education[0][institution]" required>
                                </div>
                            </div>
                            
                            <div class="form-row row">
                                <div class="form-group col-md-5">
                                    <label for="edu_start_date_0">Start Date</label>
                                    <input type="text" class="form-control" id="edu_start_date_0" name="education[0][start_date]" placeholder="e.g., 2016" required>
                                </div>
                                <div class="form-group col-md-5">
                                    <label for="edu_end_date_0">End Date</label>
                                    <input type="text" class="form-control" id="edu_end_date_0" name="education[0][end_date]" placeholder="e.g., 2020">
                                </div>
                                <div class="form-group col-md-2 d-flex align-items-end">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="current_education_0" name="education[0][current_education]">
                                        <label class="form-check-label" for="current_education_0">Current</label>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="edu_description_0">Description</label>
                                    <textarea class="form-control" id="edu_description_0" name="education[0][description]" rows="3" placeholder="Describe your achievements, relevant coursework, etc..."></textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <button type="button" id="add-education" class="btn-add-item">
                        <i class="bi bi-plus-circle"></i> Add Another Education
                    </button>
                </div>
                
                <!-- Skills Section -->
                <div id="skills" class="form-section">
                    <div class="form-section-header">
                        <div class="form-section-icon">
                            <i class="bi bi-stars"></i>
                        </div>
                        <h2 class="form-section-title">Skills</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="skills_input">Skills</label>
                            <textarea class="form-control" id="skills_input" name="skills" rows="3" placeholder="Enter your skills, separated by commas..."></textarea>
                            <small class="form-text">List your relevant skills, separated by commas (e.g., Project Management, Strategic Planning, Team Leadership)</small>
                        </div>
                    </div>
                </div>
                
                <!-- Additional Sections -->
                <div id="additional-sections" class="form-section">
                    <div class="form-section-header">
                        <div class="form-section-icon">
                            <i class="bi bi-plus-circle"></i>
                        </div>
                        <h2 class="form-section-title">Additional Sections</h2>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="add_languages" name="add_languages">
                                <label class="form-check-label" for="add_languages">Languages</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="add_certifications" name="add_certifications">
                                <label class="form-check-label" for="add_certifications">Certifications</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="add_projects" name="add_projects">
                                <label class="form-check-label" for="add_projects">Projects</label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="languages-section" class="additional-section" style="display: none;">
                        <h3 class="additional-section-title">Languages</h3>
                        <div id="language-items" class="dynamic-form-items">
                            <!-- Language items will be added here -->
                        </div>
                        <button type="button" id="add-language" class="btn-add-item">
                            <i class="bi bi-plus-circle"></i> Add Language
                        </button>
                    </div>
                    
                    <div id="certifications-section" class="additional-section" style="display: none;">
                        <h3 class="additional-section-title">Certifications</h3>
                        <div id="certification-items" class="dynamic-form-items">
                            <!-- Certification items will be added here -->
                        </div>
                        <button type="button" id="add-certification" class="btn-add-item">
                            <i class="bi bi-plus-circle"></i> Add Certification
                        </button>
                    </div>
                    
                    <div id="projects-section" class="additional-section" style="display: none;">
                        <h3 class="additional-section-title">Projects</h3>
                        <div id="project-items" class="dynamic-form-items">
                            <!-- Project items will be added here -->
                        </div>
                        <button type="button" id="add-project" class="btn-add-item">
                            <i class="bi bi-plus-circle"></i> Add Project
                        </button>
                    </div>
                </div>
                
                <!-- Form Actions -->
                <div class="form-actions">
                    <button type="button" class="btn-form-action btn-secondary" onclick="window.history.back()">Cancel</button>
                    <div>
                        <button type="button" class="btn-form-action btn-secondary me-2" id="btn-preview">Preview</button>
                        <button type="submit" class="btn-form-action btn-primary">Save & Continue</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Navigation highlighting
        const navLinks = document.querySelectorAll('.form-nav-link');
        const sections = document.querySelectorAll('.form-section');
        
        // Smooth scroll to section when clicking nav links
        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetSection = document.querySelector(targetId);
                
                window.scrollTo({
                    top: targetSection.offsetTop - 20,
                    behavior: 'smooth'
                });
                
                // Update active link
                navLinks.forEach(link => link.classList.remove('active'));
                this.classList.add('active');
            });
        });
        
        // Update active link on scroll
        window.addEventListener('scroll', function() {
            let current = '';
            
            sections.forEach(section => {
                const sectionTop = section.offsetTop - 100;
                const sectionHeight = section.clientHeight;
                
                if (pageYOffset >= sectionTop) {
                    current = '#' + section.getAttribute('id');
                }
            });
            
            navLinks.forEach(link => {
                link.classList.remove('active');
                if (link.getAttribute('href') === current) {
                    link.classList.add('active');
                }
            });
        });
        
        // Dynamic form items (Experience)
        let experienceIndex = 1;
        
        document.getElementById('add-experience').addEventListener('click', function() {
            const experienceItems = document.getElementById('experience-items');
            const newItem = document.createElement('div');
            newItem.className = 'dynamic-form-item';
            newItem.setAttribute('data-index', experienceIndex);
            
            newItem.innerHTML = `
                <div class="dynamic-form-item-header">
                    <h3 class="dynamic-form-item-title">Experience #${experienceIndex + 1}</h3>
                    <div class="dynamic-form-item-actions">
                        <button type="button" class="btn-item-action delete" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-row row">
                    <div class="form-group col-md-6">
                        <label for="job_title_${experienceIndex}">Job Title</label>
                        <input type="text" class="form-control" id="job_title_${experienceIndex}" name="experience[${experienceIndex}][job_title]" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="employer_${experienceIndex}">Employer</label>
                        <input type="text" class="form-control" id="employer_${experienceIndex}" name="experience[${experienceIndex}][employer]" required>
                    </div>
                </div>
                
                <div class="form-row row">
                    <div class="form-group col-md-5">
                        <label for="start_date_${experienceIndex}">Start Date</label>
                        <input type="text" class="form-control" id="start_date_${experienceIndex}" name="experience[${experienceIndex}][start_date]" placeholder="e.g., Jan 2020" required>
                    </div>
                    <div class="form-group col-md-5">
                        <label for="end_date_${experienceIndex}">End Date</label>
                        <input type="text" class="form-control" id="end_date_${experienceIndex}" name="experience[${experienceIndex}][end_date]" placeholder="e.g., Dec 2022">
                    </div>
                    <div class="form-group col-md-2 d-flex align-items-end">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="current_job_${experienceIndex}" name="experience[${experienceIndex}][current_job]">
                            <label class="form-check-label" for="current_job_${experienceIndex}">Current Job</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="description_${experienceIndex}">Description</label>
                        <textarea class="form-control" id="description_${experienceIndex}" name="experience[${experienceIndex}][description]" rows="4" placeholder="Describe your responsibilities and achievements..."></textarea>
                    </div>
                </div>
            `;
            
            experienceItems.appendChild(newItem);
            experienceIndex++;
            
            // Add event listener to delete button
            const deleteBtn = newItem.querySelector('.btn-item-action.delete');
            deleteBtn.addEventListener('click', function() {
                newItem.remove();
                updateExperienceTitles();
            });
        });
        
        // Delete experience item
        document.querySelectorAll('#experience-items .btn-item-action.delete').forEach(btn => {
            btn.addEventListener('click', function() {
                const item = this.closest('.dynamic-form-item');
                item.remove();
                updateExperienceTitles();
            });
        });
        
        // Update experience titles after deletion
        function updateExperienceTitles() {
            const items = document.querySelectorAll('#experience-items .dynamic-form-item');
            items.forEach((item, index) => {
                item.querySelector('.dynamic-form-item-title').textContent = `Experience #${index + 1}`;
            });
        }
        
        // Dynamic form items (Education)
        let educationIndex = 1;
        
        document.getElementById('add-education').addEventListener('click', function() {
            const educationItems = document.getElementById('education-items');
            const newItem = document.createElement('div');
            newItem.className = 'dynamic-form-item';
            newItem.setAttribute('data-index', educationIndex);
            
            newItem.innerHTML = `
                <div class="dynamic-form-item-header">
                    <h3 class="dynamic-form-item-title">Education #${educationIndex + 1}</h3>
                    <div class="dynamic-form-item-actions">
                        <button type="button" class="btn-item-action delete" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-row row">
                    <div class="form-group col-md-6">
                        <label for="degree_${educationIndex}">Degree</label>
                        <input type="text" class="form-control" id="degree_${educationIndex}" name="education[${educationIndex}][degree]" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="institution_${educationIndex}">Institution</label>
                        <input type="text" class="form-control" id="institution_${educationIndex}" name="education[${educationIndex}][institution]" required>
                    </div>
                </div>
                
                <div class="form-row row">
                    <div class="form-group col-md-5">
                        <label for="edu_start_date_${educationIndex}">Start Date</label>
                        <input type="text" class="form-control" id="edu_start_date_${educationIndex}" name="education[${educationIndex}][start_date]" placeholder="e.g., 2016" required>
                    </div>
                    <div class="form-group col-md-5">
                        <label for="edu_end_date_${educationIndex}">End Date</label>
                        <input type="text" class="form-control" id="edu_end_date_${educationIndex}" name="education[${educationIndex}][end_date]" placeholder="e.g., 2020">
                    </div>
                    <div class="form-group col-md-2 d-flex align-items-end">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="current_education_${educationIndex}" name="education[${educationIndex}][current_education]">
                            <label class="form-check-label" for="current_education_${educationIndex}">Current</label>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="edu_description_${educationIndex}">Description</label>
                        <textarea class="form-control" id="edu_description_${educationIndex}" name="education[${educationIndex}][description]" rows="3" placeholder="Describe your achievements, relevant coursework, etc..."></textarea>
                    </div>
                </div>
            `;
            
            educationItems.appendChild(newItem);
            educationIndex++;
            
            // Add event listener to delete button
            const deleteBtn = newItem.querySelector('.btn-item-action.delete');
            deleteBtn.addEventListener('click', function() {
                newItem.remove();
                updateEducationTitles();
            });
        });
        
        // Delete education item
        document.querySelectorAll('#education-items .btn-item-action.delete').forEach(btn => {
            btn.addEventListener('click', function() {
                const item = this.closest('.dynamic-form-item');
                item.remove();
                updateEducationTitles();
            });
        });
        
        // Update education titles after deletion
        function updateEducationTitles() {
            const items = document.querySelectorAll('#education-items .dynamic-form-item');
            items.forEach((item, index) => {
                item.querySelector('.dynamic-form-item-title').textContent = `Education #${index + 1}`;
            });
        }
        
        // Additional sections toggle
        document.getElementById('add_languages').addEventListener('change', function() {
            const languagesSection = document.getElementById('languages-section');
            languagesSection.style.display = this.checked ? 'block' : 'none';
            
            if (this.checked && document.querySelectorAll('#language-items .dynamic-form-item').length === 0) {
                addLanguageItem();
            }
        });
        
        document.getElementById('add_certifications').addEventListener('change', function() {
            const certificationsSection = document.getElementById('certifications-section');
            certificationsSection.style.display = this.checked ? 'block' : 'none';
            
            if (this.checked && document.querySelectorAll('#certification-items .dynamic-form-item').length === 0) {
                addCertificationItem();
            }
        });
        
        document.getElementById('add_projects').addEventListener('change', function() {
            const projectsSection = document.getElementById('projects-section');
            projectsSection.style.display = this.checked ? 'block' : 'none';
            
            if (this.checked && document.querySelectorAll('#project-items .dynamic-form-item').length === 0) {
                addProjectItem();
            }
        });
        
        // Dynamic language items
        let languageIndex = 0;
        
        function addLanguageItem() {
            const languageItems = document.getElementById('language-items');
            const newItem = document.createElement('div');
            newItem.className = 'dynamic-form-item';
            newItem.setAttribute('data-index', languageIndex);
            
            newItem.innerHTML = `
                <div class="dynamic-form-item-header">
                    <h3 class="dynamic-form-item-title">Language #${languageIndex + 1}</h3>
                    <div class="dynamic-form-item-actions">
                        <button type="button" class="btn-item-action delete" title="Delete">
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
                
                <div class="form-row row">
                    <div class="form-group col-md-6">
                        <label for="language_name_${languageIndex}">Language</label>
                        <input type="text" class="form-control" id="language_name_${languageIndex}" name="languages[${languageIndex}][name]" required>
                    </div>
                    <div class="form-group col-md-6">
                        <label for="language_proficiency_${languageIndex}">Proficiency</label>
                        <select class="form-control" id="language_proficiency_${languageIndex}" name="languages[${languageIndex}][proficiency]">
                            <option value="native">Native</option>
                            <option value="fluent">Fluent</option>
                            <option value="advanced">Advanced</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="basic">Basic</option>
                        </select>
                    </div>
                </div>
            `;
            
            languageItems.appendChild(newItem);
            languageIndex++;
            
            // Add event listener to delete button
            const deleteBtn = newItem.querySelector('.btn-item-action.delete');
            deleteBtn.addEventListener('click', function() {
                newItem.remove();
                updateLanguageTitles();
            });
        }
        
        document.getElementById('add-language').addEventListener('click', addLanguageItem);
        
        function updateLanguageTitles() {
            const items = document.querySelectorAll('#language-items .dynamic-form-item');
            items.forEach((item, index) => {
                item.querySelector('.dynamic-form-item-title').textContent = `Language #${index + 1}`;
            });
        }
        
        // Live preview functionality
        const formInputs = document.querySelectorAll('#resume-form input, #resume-form textarea, #resume-form select');
        const resumePreview = document.getElementById('resume-preview');
        
        formInputs.forEach(input => {
            input.addEventListener('input', updatePreview);
        });
        
        function updatePreview() {
            // Get form data
            const firstName = document.getElementById('first_name').value || 'Your';
            const lastName = document.getElementById('last_name').value || 'Name';
            const email = document.getElementById('email').value || 'email@example.com';
            const phone = document.getElementById('phone').value || '(555) 123-4567';
            const city = document.getElementById('city').value || 'City';
            const state = document.getElementById('state').value || 'State';
            const summary = document.getElementById('summary').value || 'Professional summary will appear here...';
            
            // Generate preview HTML
            const previewHTML = `
                <div class="resume minimalist">
                    <header class="resume-header">
                        <h1 class="resume-name">${firstName} ${lastName}</h1>
                        <div class="resume-contact">
                            <span>${email}</span>
                            <span>${phone}</span>
                            <span>${city}, ${state}</span>
                        </div>
                    </header>
                    
                    <section class="resume-summary">
                        <h2 class="section-title">Summary</h2>
                        <div class="section-content">
                            <p>${summary}</p>
                        </div>
                    </section>
                    
                    <!-- More sections will be added as user fills the form -->
                </div>
                
                <style>
                /* Minimalist Resume Preview Styles */
                .resume.minimalist {
                    font-family: 'Helvetica', 'Arial', sans-serif;
                    color: #333;
                    line-height: 1.5;
                }
                
                .resume.minimalist .resume-header {
                    margin-bottom: 20px;
                }
                
                .resume.minimalist .resume-name {
                    font-size: 24px;
                    font-weight: 300;
                    margin: 0 0 10px 0;
                    letter-spacing: 1px;
                }
                
                .resume.minimalist .resume-contact {
                    display: flex;
                    flex-direction: column;
                    gap: 5px;
                    font-size: 14px;
                    color: #666;
                }
                
                .resume.minimalist .section-title {
                    font-size: 14px;
                    font-weight: 700;
                    text-transform: uppercase;
                    letter-spacing: 2px;
                    margin: 20px 0 10px 0;
                    color: #999;
                }
                </style>
            `;
            
            resumePreview.innerHTML = previewHTML;
        }
        
        // Initialize preview
        updatePreview();
        
        // Preview button functionality
        document.getElementById('btn-preview').addEventListener('click', function() {
            // In a real app, this would open a modal or new tab with a full preview
            alert('In a production environment, this would open a full preview of your resume.');
        });
    });
</script>
{% endblock %}